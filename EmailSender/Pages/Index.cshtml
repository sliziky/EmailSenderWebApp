@page
@model EmailSender.Models.MainModel

@{
    ViewData[ "Title" ] = "Contacts";
}

<!DOCTYPE html>
<html>
<body>
    <h1>Contacts</h1>


    <table class="table" id="personTable">
        <thead>
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Address</th>
                <th>Email</th>
                <th>Send email to</th>
            </tr>
        </thead>
        <tbody>
            @{
                foreach ( var item in Model.Person ) {
                    <tr>
                        <td>
                            @Html.DisplayFor( modelItem => item.FirstName )
                        </td>
                        <td>
                            @Html.DisplayFor( modelItem => item.LastName )
                        </td>
                        <td>
                            @Html.DisplayFor( modelItem => item.Address )
                        </td>
                        <td>
                            @Html.DisplayFor( modelItem => item.Email )
                        </td>
                        <td>
                            <input type="checkbox" />
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>


    <form method="post">
        <button type="button" onclick="SendEmail()">Send emails</button>
    </form>

    <script type="text/javascript">

        /**
         * Parses checked emails from table into array
         * */
        function ParseCheckedEmails() {
            var EMAIL_CELL = 3;
            var grid = document.getElementById("personTable");

            var checkBoxes = grid.getElementsByTagName("INPUT");
            var checkedMails = new Array();

            for ( var i = 0; i < checkBoxes.length; i++ ) {
                if ( checkBoxes[ i ].checked ) {
                    var row = checkBoxes[ i ].parentNode.parentNode;
                    checkedMails.push( row.cells[ EMAIL_CELL ].innerHTML );
                }
            }
            return checkedMails;
        }

        /**
         * Opens default email client and fills "To:" with checked emails 
         */
        function SendEmail() {
            var mail = "mailto:" + ParseCheckedEmails().join( ";" );
            window.open( mail );
        }

    </script>
</body>
</html>
